{"version":3,"file":"programs.component.js","sourceRoot":"","sources":["../home/vigilate/frontend/frontend/tmp/broccoli_type_script_compiler-input_base_path-tkvoKOOh.tmp/0/src/app/programs.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { User } from './user.model';\nimport { ProgramsService } from './programs.service';\nimport { PaginatePipe, PaginationControlsCmp, PaginationService } from 'ng2-pagination/dist/ng2-pagination';\nimport { StorageService } from './storage.service'\nimport { StationsService } from './stations.service';\nimport { StationPipe } from './station.pipe';\nimport { FilterPipe } from './filter.pipe';\nimport { NotificationsService } from './notifications.service'\n\n@Component({\n    selector: 'programs',\n    templateUrl: 'app/programs.component.html',\n    directives: [PaginationControlsCmp],\n    pipes: [PaginatePipe, StationPipe, FilterPipe],\n    providers: [PaginationService]\n})\n\nexport class ProgramsComponent implements OnInit {\n\n    pageLoading = true;\n    cacheSubscription = null;\n    progs = []\n    stations_list = []\n    stations = {}\n    filtered_station = 'all';\n    filter = \"\"\n    p = 0;\n\n    filter_options = [\"is:vulnerable\",\n\t\t      \"is:!vulnerable\",\n\t\t     \"version:\",\n\t\t     \"station:\"\n\t\t    ];\n    \n    constructor (private programsService: ProgramsService,\n\t\t private router: Router,\n\t\t private storageService: StorageService,\n\t\t private stationsService: StationsService,\n\t\t private notificationsService: NotificationsService\n\t\t){}\n\n    ngOnInit() {\n\tthis.p = this.storageService.get(\"ProgramsComponent\", \"page\", 1);\n\tthis.updateList();\n\n\tlet tour = this.storageService.get(\"Tour\", \"current_step\", \"\");\n\tif (tour == \"/programs\") {\n\t    let tour_current_step = \"end\";\n\t    this.storageService.store(\"Tour\", \"current_step\", tour_current_step);\n\t}\n\n\tthis.cacheSubscription = this.programsService.cacheTimeout.subscribe(\n\t    () => {\n\t\tthis.updateList();\n\t    }\n\t);\n\n    }\n\n    ngOnDestroy() {\n\tif (this.cacheSubscription)\n\t    this.cacheSubscription.unsubscribe();\n    }\n\n    updateList() {\n\tthis.pageLoading = true;\n\tthis.stationsService.getStationsList().subscribe(\n\t    stations => {\n\t\tthis.stations_list = stations;\n\t\tfor (let st of stations)\n\t\t    this.stations[st.id] = st.name;\n\t\tthis.updateListProgOnly();\n\t    },\n\t    error => {\n\t\tthis.pageLoading = false;\n\t\tif (error == \"NeedToReconnect\")\n\t\t    throw error;\n\t    }\n\t);\n    }\n    \n    updateListProgOnly() {\n\tthis.pageLoading = true;\n\tthis.programsService.getProgramsList()\n            .subscribe(\n                programs => {\n\t\t    for (let i = 0 ; i < programs.length ; i++)\n\t\t\tprograms[i].station_name = this.stations[programs[i].poste];\n\t\t    this.progs = programs;\n\t\t    this.pageLoading = false;\n\t\t},\n                error =>  {\n\t\t    this.pageLoading = false;\n\t\t    if (error == \"NeedToReconnect\")\n\t\t\tthrow error;\n\t\t    console.log(error);\n\t\t});\n    }\n\n    onClick(id) {\n\tthis.router.navigate(['/programs', id]);\n    }\n    \n    onClickDelete(id, index_array) {\n\tthis.programsService.deleteProgram(id)\n            .subscribe(\n                programs => {\n\t\t    index_array = index_array + (this.p - 1) * 100;\n\t\t    let tmp = this.progs.slice(0, index_array);\n\t\t    if (index_array + 1 < this.progs.length)\n\t\t\ttmp = tmp.concat(this.progs.slice(index_array + 1));\n\t\t    this.progs = tmp;\n\t\t},\n                error =>  {\n\t\t    if (error == \"NeedToReconnect\")\n\t\t\tthrow error;\n\t\t    if (error.code == 404)\n\t\t\tthis.updateList();\n\t\t    else\n\t\t\tthis.notificationsService.alert(error.msg);\n\t\t});\n    }\n\n    onNewProgram() {\n\tthis.router.navigate(['/programs', \"new\"]);\n    }\n\n    onPageChange(page) {\n\tthis.storageService.store(\"ProgramsComponent\", \"page\", page);\n    }\n\n    selectStation(st) {\n\tthis.filtered_station = st;\n    }\n\n    onClickFilter(f) {\n\tif (this.filter.indexOf(f) != -1)\n\t    return;\n\tif (f.indexOf(\"!\") != -1) {\n\t    let tmp = f.replace(\":!\", \":\");\n\t    if (this.filter.indexOf(tmp) != -1) {\n\t\tthis.filter = this.filter.replace(tmp, f);\n\t\treturn;\n\t    }\n\t}\n\telse {\n\t    let tmp = f.replace(\":\", \":!\");\n\t    if (this.filter.indexOf(tmp) != -1) {\n\t\tthis.filter = this.filter.replace(tmp, f);\n\t\treturn;\n\t    }\n\t}\n\tthis.filter = this.filter + \" \" + f;\n    }\n\n    onClickRefresh() {\n\tthis.programsService.trigerEmitTimeout();\n    }\n\n    onClickAlert(alert_id) {\n\tthis.router.navigate(['/alerts', alert_id]);\n    }\n}\n"]}