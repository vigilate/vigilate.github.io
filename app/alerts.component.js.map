{"version":3,"file":"alerts.component.js","sourceRoot":"","sources":["../home/vigilate/frontend/frontend/tmp/broccoli_type_script_compiler-input_base_path-tkvoKOOh.tmp/0/src/app/alerts.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { User } from './user.model';\nimport { AuthService } from './auth.service';\nimport { AlertsService } from './alerts.service';\nimport {PaginatePipe, PaginationControlsCmp, PaginationService} from 'ng2-pagination/dist/ng2-pagination';\nimport { StationsService } from './stations.service';\nimport { StorageService } from './storage.service'\nimport { StationPipe } from './station.pipe';\nimport { FilterPipe } from './filter.pipe';\n\n@Component({\n    selector: 'alerts',\n    templateUrl: 'app/alerts.component.html',\n    directives: [PaginationControlsCmp],\n    pipes: [PaginatePipe, StationPipe, FilterPipe],\n    providers: [PaginationService]\n})\n\nexport class AlertsComponent implements OnInit, OnDestroy {\n\n    pageLoading = true;\n    cacheSubscription = null;\n    alerts = []\n    p = 0;\n    stations_list = []\n    stations = {}\n    filtered_station = 'all';\n    loadingMarkAll = {\n\tread: false,\n\tunread: false\n    };\n\n    filter = \"\";\n    filter_options = [\"is:read\",\n\t\t      \"is:!read\",\n\t\t      \"state:exploit\",\n\t\t      \"state:patch\",\n\t\t      \"version:\",\n\t\t      \"station:\"\n\t\t     ];\n    \n    constructor (private authService: AuthService,\n\t\t private alertsService: AlertsService,\n\t\t private router: Router,\n\t\t private storageService: StorageService,\n\t\t private stationsService: StationsService){}\n\n    ngOnInit() {\n\tthis.p = this.storageService.get(\"AlertsComponent\", \"page\", 1);\n\tthis.updateList()\n\n\tthis.cacheSubscription = this.alertsService.cacheTimeout.subscribe(\n\t    () => {\n\t\tthis.updateList();\n\t    }\n\t);\n    }\n\n    ngOnDestroy() {\n\tif (this.cacheSubscription)\n\t    this.cacheSubscription.unsubscribe();\n    }\n\n    updateList() {\n\tthis.pageLoading = true;\n\tthis.stationsService.getStationsList().subscribe(\n\t    stations => {\n\t\tthis.stations_list = stations;\n\t\tfor (let st of stations)\n\t\t    this.stations[st.id] = st.name;\n\t\tthis.updateListAlertOnly();\n\t    },\n\t    error => {\n\t\tthis.pageLoading = false;\n\t\tif (error == \"NeedToReconnect\")\n\t\t    throw error;\n\t    }\n\t);\n}\n    \n    updateListAlertOnly() {\n\tthis.pageLoading = true;\n\tthis.alertsService.getAlertsList()\n            .subscribe(\n                alerts => {\n\t\t    for (let i = 0 ; i < alerts.length ; i++)\n\t\t    {\n\t\t\talerts[i].loadingMark = false;\n\t\t\talerts[i].program_info.station_name = this.stations[alerts[i].program_info.poste];\n\t\t    }\n\t\t    this.alerts = alerts;\n\t\t    this.pageLoading = false;\n\t\t},\n                error =>  {\n\t\t    this.pageLoading = false;\n\t\t    if (error == \"NeedToReconnect\")\n\t\t\tthrow error;\n\t\t    console.log(error);\n\t\t});\n    }\n\n    onClick(id) {\n\tthis.router.navigate(['/alerts', id]);\n    }\n\n    onPageChange(page) {\n\tthis.storageService.store(\"AlertsComponent\", \"page\", page);\n    }\n\n    onMark(obj) {\n\tobj.loadingMark = true;\n\tif (obj.view) {\n\t    this.alertsService.markUnread(obj.id)\n\t\t.subscribe(\n                    ret => {\n\t\t\tobj.loadingMark = false;\n\t\t\tthis.alertsService.trigerEmitTimeout()\n\t\t    },\n                    error =>  {\n\t\t\tobj.loadingMark = false;\n\t\t\tif (error == \"NeedToReconnect\")\n\t\t\t    throw error;\n\t\t\tconsole.log(error);\n\t\t    });\n\t}\n\telse {\n\t    this.alertsService.markRead(obj.id)\n\t\t.subscribe(\n                    ret => {\n\t\t\tobj.loadingMark = false;\n\t\t\tthis.alertsService.trigerEmitTimeout()\n\t\t    },\n                    error =>  {\n\t\t\tobj.loadingMark = false;\n\t\t\tif (error == \"NeedToReconnect\")\n\t\t\t    throw error;\n\t\t\tconsole.log(error);\n\t\t    });\n\t}\n    }\n\n    onMarkAll(act) {\n\tthis.loadingMarkAll[act] = true;\n\tlet fct;\n\n\tif (act == 'unread')\n\t    fct = this.alertsService.markAllUnread();\n\telse\n\t    fct = this.alertsService.markAllRead();\n\n\tfct.subscribe(\n            ret => {\n\t\tthis.loadingMarkAll[act] = false;\n\t\tthis.alertsService.trigerEmitTimeout()\n\t    },\n            error =>  {\n\t\tthis.loadingMarkAll[act] = false;\n\t\tif (error == \"NeedToReconnect\")\n\t\t    throw error;\n\t\tconsole.log(error);\n\t    });\n    }\n\n    selectStation(st) {\n\tthis.filtered_station = st;\n    }\n\n    onClickFilter(f) {\n\tif (this.filter.indexOf(f) != -1)\n\t    return;\n\tif (f.indexOf(\"!\") != -1) {\n\t    let tmp = f.replace(\":!\", \":\");\n\t    if (this.filter.indexOf(tmp) != -1) {\n\t\tthis.filter = this.filter.replace(tmp, f);\n\t\treturn;\n\t    }\n\t}\n\telse {\n\t    let tmp = f.replace(\":\", \":!\");\n\t    if (this.filter.indexOf(tmp) != -1) {\n\t\tthis.filter = this.filter.replace(tmp, f);\n\t\treturn;\n\t    }\n\t}\n\tthis.filter = this.filter + \" \" + f;\n    }\n\n    onClickRefresh() {\n\tthis.alertsService.trigerEmitTimeout();\n    }\n}\n"]}