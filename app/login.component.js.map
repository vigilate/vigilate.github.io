{"version":3,"file":"login.component.js","sourceRoot":"","sources":["../home/vigilate/frontend/frontend/tmp/broccoli_type_script_compiler-input_base_path-tkvoKOOh.tmp/0/src/app/login.component.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,qBAAkC,eAAe,CAAC,CAAA;AAClD,uBAAuC,iBAAiB,CAAC,CAAA;AACzD,6BAA4B,gBAAgB,CAAC,CAAA;AAE7C,mCAAkC,sBAAsB,CAAC,CAAA;AACzD,6BAA4B,gBAAgB,CAAC,CAAA;AAC7C,gCAA+B,mBAC/B,CAAC,CADiD;AAClD,iCAA+B,oBAC/B,CAAC,CADkD;AACnD,uBAAgF,iBAAiB,CAAC,CAAA;AAClG,sCAAqC,yBAErC,CAAC,CAF6D;AAQ9D;IAgBI,wBAAqB,WAAwB,EACtC,WAAwB,EACxB,MAAc,EACd,KAAqB,EACrB,iBAAoC,EACpC,cAA8B,EAC9B,OAAoB,EACpB,oBAA0C;QAP5B,gBAAW,GAAX,WAAW,CAAa;QACtC,gBAAW,GAAX,WAAW,CAAa;QACxB,WAAM,GAAN,MAAM,CAAQ;QACd,UAAK,GAAL,KAAK,CAAgB;QACrB,sBAAiB,GAAjB,iBAAiB,CAAmB;QACpC,mBAAc,GAAd,cAAc,CAAgB;QAC9B,YAAO,GAAP,OAAO,CAAa;QACpB,yBAAoB,GAApB,oBAAoB,CAAsB;QArBjD,SAAI,GAAS,IAAI,CAAC;QAClB,UAAK,GAAG,EAAE,CAAC;QACX,aAAQ,GAAG,EAAE,CAAC;QACd,iBAAY,GAAG,KAAK,CAAC;QACrB,kBAAa,GAAG,KAAK,CAAC;QACtB,YAAO,GAAG,KAAK,CAAC;QAEhB,SAAI,GAAG;YACV,IAAI,EAAE,IAAI;YACV,KAAK,EAAE,IAAI;YACX,QAAQ,EAAE,IAAI;SACV,CAAA;QACD,gBAAW,GAAG,EAAE,CAAC;IAUhB,CAAC;IAEF,iCAAQ,GAAR;QACH,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,cAAc,IAAI,IAAI,CAAC,WAAW,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;YAClG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC;QACzC,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,gBAAO,CAAC,EAAE,EAAC,mBAAU,CAAC,OAAO,CAAC,CAAC,mBAAU,CAAC,QAAQ,EAAE,iCAAc,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACpG,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,gBAAO,CAAC,EAAE,EAAE,mBAAU,CAAC,QAAQ,CAAC,CAAC;QAC1D,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC;YAChC,KAAK,EAAG,IAAI,CAAC,IAAI,CAAC,KAAK;YACvB,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ;SAC/B,CAAC,CAAC;IACA,CAAC;IAED,sCAAa,GAAb;QACH,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC;YACtB,MAAM,CAAC;QACX,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,KAAK,EAAE,CAAC;IACV,CAAC;IAED,8BAAK,GAAL;QAAA,iBAgBC;QAfJ,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC;aACrC,SAAS,CACpB,UAAA,IAAI;YACA,KAAI,CAAC,OAAO,EAAE,CAAC;QACnB,CAAC,EACD,UAAA,KAAK;YACD,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YACrB,KAAI,CAAC,YAAY,GAAG,KAAK,CAAC;YAC1B,EAAE,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;gBACpB,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;oBACvB,KAAI,CAAC,WAAW,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBAClD,CAAC;YACE,CAAC;QACL,CAAC,CAAC,CAAC;IACD,CAAC;IAED,gCAAO,GAAP;QAAA,iBAoBC;QAnBJ,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE;aACd,SAAS,CACN,UAAA,IAAI;YACd,KAAI,CAAC,YAAY,GAAG,KAAK,CAAC;YAC1B,KAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAA;YAC7B,IAAI,KAAK,GAAG,KAAI,CAAC,cAAc,CAAC,GAAG,CAAC,WAAW,EAAE,UAAU,EAAE,WAAW,CAAC,CAAC;YAC1E,KAAI,CAAC,cAAc,CAAC,MAAM,CAAC,WAAW,EAAE,UAAU,CAAC,CAAC;YACpD,KAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC,CAAC;QACvC,CAAC,EACY,UAAA,KAAK;YACf,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YACrB,KAAI,CAAC,YAAY,GAAG,KAAK,CAAC;YAC1B,EAAE,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;gBACpB,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;oBACvB,KAAI,CAAC,WAAW,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBAClD,CAAC;YACE,CAAC;QACL,CAAC,CAAC,CAAC;IAED,CAAC;IAED,uCAAc,GAAd;QAAA,iBAqBC;QApBJ,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC;YACtB,MAAM,CAAC;QACX,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC;aACtC,SAAS,CACN,UAAA,IAAI;YACd,KAAI,CAAC,aAAa,GAAG,KAAK,CAAC;YAC3B,KAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,GAAG,UAAU,CAAC,CAAC;QACzE,CAAC,EACa,UAAA,KAAK;YACf,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YACrB,KAAI,CAAC,aAAa,GAAG,KAAK,CAAC;YAC3B,EAAE,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;gBACpB,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;oBACvB,KAAI,CAAC,WAAW,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBAClD,CAAC;YACE,CAAC;QACL,CAAC,CAAC,CAAC;IACD,CAAC;IAhHL;QAAC,gBAAS,CAAC;YACP,WAAW,EAAE,0BAA0B;YACvC,SAAS,EAAE,CAAC,yBAAyB,CAAC;YACtC,UAAU,EAAE,CAAC,wBAAe,CAAC;SAChC,CAAC;;sBAAA;IA6GF,qBAAC;AAAD,CAAC,AA3GD,IA2GC;AA3GY,sBAAc,iBA2G1B,CAAA","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { AuthService } from './auth.service';\nimport { User } from './user.model';\nimport { BackgroundService } from './background.service';\nimport { UserService } from './user.service';\nimport { StorageService } from './storage.service'\nimport { EmailValidator } from './validation.class'\nimport { FormBuilder, Validators, Control, ControlGroup, FORM_DIRECTIVES } from '@angular/common';\nimport { NotificationsService } from './notifications.service'\n\n@Component({\n    templateUrl: 'app/login.component.html',\n    styleUrls: ['app/login.component.css'],\n    directives: [FORM_DIRECTIVES]\n})\n\nexport class LoginComponent implements OnInit {\n\n    user: User = null;\n    email = \"\";\n    password = \"\";\n    loadingLogin = false;\n    loadingSignin = false;\n    clicked = false;\n\n    ctrl = {\n\tform: null,\n\temail: null,\n\tpassword: null\n    }\n    error_field = {};\n\n    constructor (private authService: AuthService,\n\t\t private userService: UserService,\n\t\t private router: Router,\n\t\t private route: ActivatedRoute,\n\t\t private backgroundService: BackgroundService,\n\t\t private storageService: StorageService,\n\t\t private builder: FormBuilder,\n\t\t private notificationsService: NotificationsService\n\t\t) {}\n\n    ngOnInit() {\n\tif (this.authService.isLoggedIn || (!this.authService.triedToConnect && this.authService.token != \"\"))\n\t    this.router.navigate(['/dashboard']);\n\tthis.ctrl.email = new Control(\"\",Validators.compose([Validators.required, EmailValidator.isValid]));\n\tthis.ctrl.password = new Control('', Validators.required);\n\tthis.ctrl.form = this.builder.group({\n\t    email:  this.ctrl.email,\n\t    password: this.ctrl.password\n\t});\n    }\n    \n    onSubmitLogin() {\n\tthis.clicked = true;\n\tif (!this.ctrl.form.valid)\n\t    return;\n\tthis.loadingLogin = true;\n\tthis.login();\n    }\n\n    login() {\n\tthis.error_field = {};\n\tthis.authService.login(this.email, this.password)\n            .subscribe(\n\t\tdata => {\n\t\t    this.getUser();\n\t\t},\n\t\terror =>  {\n\t\t    console.error(error);\n\t\t    this.loadingLogin = false;\n\t\t    if (error.json) {\n\t\t\tfor (let f in error.json) {\n\t\t\t    this.error_field[f] = error.json[f].join(\" \");\n\t\t\t}\n\t\t    }\n\t\t});\n    }\n\n    getUser() {\n\tthis.userService.getUser()\n            .subscribe(\n                data => {\n\t\t    this.loadingLogin = false;\n\t\t    this.backgroundService.init()\n\t\t    let redir = this.storageService.get(\"AuthGuard\", \"redirect\", \"dashboard\");\n\t\t    this.storageService.delete(\"AuthGuard\", \"redirect\");\n\t\t    this.router.navigate(['/' + redir]);\n\t\t\t},\n                error =>  {\n\t\t    console.error(error);\n\t\t    this.loadingLogin = false;\n\t\t    if (error.json) {\n\t\t\tfor (let f in error.json) {\n\t\t\t    this.error_field[f] = error.json[f].join(\" \");\n\t\t\t}\n\t\t    }\n\t\t});\n\n    }\n\n    onSubmitSignin() {\n\tthis.clicked = true;\n\tif (!this.ctrl.form.valid)\n\t    return;\n\tthis.error_field = {};\n\tthis.loadingSignin = true;\n\tthis.authService.signin(this.email, this.password)\n            .subscribe(\n                user => {\n\t\t    this.loadingSignin = false;\n\t\t    this.notificationsService.success(\"User \" + user.email + \" created\");\n\t\t},\n                error =>  {\n\t\t    console.error(error);\n\t\t    this.loadingSignin = false;\n\t\t    if (error.json) {\n\t\t\tfor (let f in error.json) {\n\t\t\t    this.error_field[f] = error.json[f].join(\" \");\n\t\t\t}\n\t\t    }\n\t\t});\n    }\n}\n"]}